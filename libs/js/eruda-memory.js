(function(t,i){if(typeof define==="function"&&define.amd){define([],i)}else if(typeof module==="object"&&module.exports){module.exports=i()}else{t.erudaMemory=i()}})(this,function(){var t=window.innerWidth;return function(i){var e=t,a=192,s=12,n=8,r=12,o=40,l=t-24,h=142,f="#fff",c="#009688",d=2,u="MB";var _=i.util,p=i.Settings,m=Math.round,v=i.Tool;var g=v.extend({name:"memory",init:function(t,i){this.callSuper(v,"init",arguments);this._style=_.evalCss([".eruda-dev-tools .eruda-tools .eruda-memory {padding: 10px !important;}","canvas {width: 100%; border-radius: 4px; box-shadow: 0 2px 2px 0 rgba(0, 0, 0, 0.05), 0 1px 4px 0 rgba(0, 0, 0, 0.08), 0 3px 1px -2px rgba(0, 0, 0, 0.2);}",".eruda-not-supported {background: #f44336; color: #fff; padding: 10px; border-radius: 4px; text-align: center; box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .05), 0 1px 4px 0 rgba(0, 0, 0, .08), 0 3px 1px -2px rgba(0, 0, 0, .2)}"].join(".eruda-dev-tools .eruda-tools .eruda-memory "));this._container=i;this._isRunning=false;this._beginTime=_.now();this._prevTime=this._beginTime;this._frames=0;this._min=Infinity;this._max=0;this._alwaysActivated=true;this._appendTpl();this._initCanvas();this._initCfg()},show:function(){this._start();this.callSuper(v,"show",arguments)},hide:function(){if(!this._alwaysActivated)this._stop();this.callSuper(v,"hide",arguments)},destroy:function(){this._stop();_.evalCss.remove(this._style);this.callSuper(v,"destroy",arguments);this._rmCfg()},_rmCfg:function(){var t=this.config;var i=this._container.get("settings");if(!i)return;i.remove(t,"alwaysActivated").remove("Memory")},_start:function(){var t=performance.memory;if(!t){this._$el.html('<div class="eruda-not-supported">Not supported for this browser!</div>');return}if(this._isRunning)return;var i=this;this._isRunning=true;function e(){if(!i._isRunning)return;i._update();requestAnimationFrame(e)}e()},_stop:function(){this._isRunning=false;this._beginTime=_.now();this._prevTime=this._beginTime;this._frames=0},_appendTpl:function(){this._$el.html("<canvas></canvas>");this._canvas=this._$el.find("canvas").get(0);this._ctx=this._canvas.getContext("2d")},_initCanvas:function(){var t=this._canvas,i=this._ctx;t.width=e;t.height=a;i.font="bold 18px Helvetica,Arial,sans-serif";i.textBaseline="top";i.fillStyle=f;i.fillRect(0,0,e,a);i.fillStyle=c;i.fillText(u,s,n);i.fillRect(r,o,l,h);i.fillStyle=f;i.globalAlpha=.9;i.fillRect(r,o,l,h)},_initCfg:function(){var t=this._container;var i=this.config=p.createCfg("eruda-memory",{alwaysActivated:true});if(!i.get("alwaysActivated"))this._alwaysActivated=false;var e=this;i.on("change",function(t,i){switch(t){case"alwaysActivated":e._alwaysActivated=i;return}});var a=t.get("settings");a.text("Memory").switch(i,"alwaysActivated","Always Activated").separator()},_update:function(){this._frames++;var t=this._prevTime,i=_.now();if(i>t+1e3){var e=performance.memory;this._draw(e.usedJSHeapSize/1048576,e.totalJSHeapSize/1048576);this._prevTime=i;this._frames=0}this._beginTime=i},_draw:function(t,i){this._min=Math.min(this._min,t);this._max=Math.max(this._max,t);var a=this._min,_=this._max,p=this._canvas,v=this._ctx;v.fillStyle=f;v.globalAlpha=1;v.fillRect(0,0,e,o);v.fillStyle=c;v.fillText(m(t)+""+u+" ("+m(a)+"-"+m(_)+")",s,n);v.drawImage(p,r+d,o,l-d,h,r,o,l-d,h);v.fillRect(r+l-d,o,d,h);v.fillStyle=f;v.globalAlpha=.9;v.fillRect(r+l-d,o,d,m((1-t/i)*h))}});return new g}});